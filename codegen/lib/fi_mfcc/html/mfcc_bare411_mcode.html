<pre class="code">
<span class="srcline"><span class="lineno"><a href="90,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S2T149U3">mel</span> = mfcc_bare(<span class="var type1" id="S3T26U6">samples_in_window</span>, <span class="var type1" id="S4T26U7">hamming_coeff</span>, <span class="var type1" id="S5T140U8">mel_filterbank</span>, <span class="var type1" id="S6T5U9">fftA</span>, <span class="var type1" id="S7T5U10">fftB</span>, <span class="var type1" id="S8T148U11">dct_coeff</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="90,2" id="srcline2"> 2</a></span><span class="line"><span class="comment">% initialization</span></span></span>
<span class="srcline"><span class="lineno"><a href="90,3" id="srcline3"> 3</a></span><span class="line"><span class="mxinfo" id="T5:U8"><span class="var type1" id="S9T5U14">fs</span> = <span class="mxinfo" id="T5:U10">8000</span></span>;  <span class="comment">% 8kHz sampling frequency.</span></span></span>
<span class="srcline"><span class="lineno"><a href="90,4" id="srcline4"> 4</a></span><span class="line"><span class="mxinfo" id="T5:U11"><span class="var type1" id="S10T5U18">n</span> = <span class="mxinfo" id="T5:U13">pow2(floor(log2(0.03*<span class="var type1" id="S9T5U27">fs</span>)))</span></span>;  <span class="comment">% 128 (size of windows).</span></span></span>
<span class="srcline"><span class="lineno"><a href="90,5" id="srcline5"> 5</a></span><span class="line"><span class="mxinfo" id="T5:U15"><span class="var type1" id="S14T5U30">stride</span>=<span class="mxinfo" id="T5:U17">floor(<span class="mxinfo" id="T5:U18"><span class="var type1" id="S10T5U34">n</span>/2</span>)</span></span>;  <span class="comment">% 64 step size for subsequent windows.</span></span></span>
<span class="srcline"><span class="lineno"><a href="90,6" id="srcline6"> 6</a></span><span class="line"><span class="mxinfo" id="T5:U20"><span class="var type1" id="S15T5U38">npassband</span> = <span class="mxinfo" id="T5:U22">floor(<span class="mxinfo" id="T5:U23">3*log(<span class="var type1" id="S9T5U45">fs</span>)</span>)</span></span>;  <span class="comment">% 26 (# of mel frequency pass band filters).</span></span></span>
<span class="srcline"><span class="lineno"><a href="90,7" id="srcline7"> 7</a></span><span class="line"><span class="mxinfo" id="T5:U25"><span class="var type1" id="S15T5U48">npassband</span> = <span class="mxinfo" id="T5:U27">32</span></span>; <span class="comment">% overrride this to power of 2.</span></span></span>
<span class="srcline"><span class="lineno"><a href="90,8" id="srcline8"> 8</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="90,9" id="srcline9"> 9</a></span><span class="line"><span class="mxinfo" id="T5:U28"><span class="var type1" id="S17T5U52">nceps</span> = <span class="mxinfo" id="T5:U30">12</span></span>; <span class="comment">% # 12 (# of cepstral coefficients (output features))</span></span></span>
<span class="srcline"><span class="lineno"><a href="90,10" id="srcline10">10</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="90,11" id="srcline11">11</a></span><span class="line"><span class="comment">% compute features for one input window</span></span></span>
<span class="srcline"><span class="lineno"><a href="90,12" id="srcline12">12</a></span><span class="line"><span class="mxinfo" id="T26:U31"><span class="var type1" id="S18T26U56">smooth_samples</span> = <span class="mxinfo" id="T26:U33"><span class="var type1" id="S3T26U58">samples_in_window</span> .* <span class="var type1" id="S4T26U59">hamming_coeff</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="90,13" id="srcline13">13</a></span><span class="line"><span class="mxinfo" id="T138:U36"><span class="var type1" id="S19T138U62">samples_in_freq</span> = <span class="mxinfo" id="T138:U38">fft(<span class="mxinfo" id="T128:U39"><span class="var type1" id="S18T26U66">smooth_samples</span>.'</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="90,14" id="srcline14">14</a></span><span class="line"><span class="mxinfo" id="T139:U41"><span class="var type1" id="S19T139U69">samples_in_freq</span> = <span class="mxinfo" id="T139:U43"><span class="var type1" id="S19T138U71">samples_in_freq</span>(<span class="mxinfo" id="T153:U45"><span class="mxinfo" id="T5:U46">1</span>:<span class="mxinfo" id="T5:U47"><span class="var type1" id="S10T5U76">n</span>/2+1</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="90,15" id="srcline15">15</a></span><span class="line"><span class="mxinfo" id="T150:U49"><span class="var type1" id="S21T150U81">power_in_freq</span> = <span class="mxinfo" id="T150:U51"><span class="mxinfo" id="T150:U52"><span class="var type1" id="S19T139U84">samples_in_freq</span>(<span class="var type1" id="S6T5U86">fftA</span>:<span class="var type1" id="S7T5U87">fftB</span>)</span> .* <span class="mxinfo" id="T150:U56">conj(<span class="mxinfo" id="T150:U57"><span class="var type1" id="S19T139U91">samples_in_freq</span>(<span class="var type1" id="S6T5U93">fftA</span>:<span class="var type1" id="S7T5U94">fftB</span>)</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="90,16" id="srcline16">16</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="90,17" id="srcline17">17</a></span><span class="line"><span class="mxinfo" id="T144:U61"><span class="var type1" id="S23T144U97">melfilter_resps</span> = <span class="mxinfo" id="T144:U63">log(<span class="mxinfo" id="T144:U64"><span class="var type1" id="S5T140U101">mel_filterbank</span> * <span class="mxinfo" id="T152:U66"><span class="mxinfo" id="T151:U67">abs(<span class="mxinfo" id="T150:U68"><span class="var type1" id="S19T139U106">samples_in_freq</span>(<span class="var type1" id="S6T5U108">fftA</span>:<span class="var type1" id="S7T5U109">fftB</span>)</span>)</span>'</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="90,18" id="srcline18">18</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="90,19" id="srcline19">19</a></span><span class="line"><span class="comment">% Compute DCT</span></span></span>
<span class="srcline"><span class="lineno"><a href="90,20" id="srcline20">20</a></span><span class="line"><span class="mxinfo" id="T144:U72"><span class="var type1" id="S25T144U112">rearrange_resp</span>=<span class="mxinfo" id="T144:U74">[<span class="mxinfo" id="T161:U75"><span class="var type1" id="S23T144U116">melfilter_resps</span>(<span class="mxinfo" id="T161:U77"><span class="mxinfo" id="T5:U78">1</span>:<span class="mxinfo" id="T5:U79">2</span>:<span class="mxinfo" id="T5:U80"><span class="var type1" id="S15T5U121">npassband</span></span></span>)</span>; <span class="mxinfo" id="T161:U82"><span class="var type1" id="S23T144U124">melfilter_resps</span>(<span class="mxinfo" id="T161:U84"><span class="mxinfo" id="T5:U85">2*fix(<span class="var type1" id="S15T5U132">npassband</span>/2)</span>:<span class="mxinfo" id="T5:U87">-2</span>:<span class="mxinfo" id="T5:U88">2</span></span>)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="90,21" id="srcline21">21</a></span><span class="line"><span class="mxinfo" id="T144:U89"><span class="var type1" id="S27T144U139">y</span>=<span class="mxinfo" id="T144:U91"><span class="mxinfo" id="T144:U92">real(<span class="mxinfo" id="T148:U93"><span class="mxinfo" id="T148:U94">fft(<span class="var type1" id="S25T144U146">rearrange_resp</span>)</span> .* <span class="var type1" id="S8T148U147">dct_coeff</span></span>)</span> / <span class="mxinfo" id="T5:U97">sqrt(2*<span class="var type1" id="S15T5U152">npassband</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="90,22" id="srcline22">22</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="90,23" id="srcline23">23</a></span><span class="line"><span class="mxinfo" id="T149:U99"><span class="var type1" id="S2T149U155">mel</span> = <span class="mxinfo" id="T149:U101">[<span class="mxinfo" id="T134:U102">log(<span class="mxinfo" id="T134:U103">sum(<span class="var type1" id="S21T150U163">power_in_freq</span>)</span>)</span>.' <span class="mxinfo" id="T162:U105"><span class="mxinfo" id="T154:U106"><span class="var type1" id="S27T144U166">y</span>(<span class="mxinfo" id="T154:U108"><span class="mxinfo" id="T5:U109">2</span>:<span class="mxinfo" id="T5:U110"><span class="var type1" id="S17T5U170">nceps</span>+1</span></span>)</span>'</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="90,24" id="srcline24">24</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="90,25" id="srcline25">25</a></span><span class="line"></span></span>
</pre>
